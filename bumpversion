#!/usr/bin/env bash

set -e

# bump
docker run \
   --env USER  --env USER_ID=`id -u` \
   --env GROUP --env GROUP_ID=`id -g` \
   --interactive --tty --rm \
   --volume $PWD:/home/$USER/host \
   bumpversion $*

###########################################
# Update README autogenerated Help section
###########################################

readonly PROJECT_PATH=$(dirname $(readlink -f $BASH_SOURCE))
cd $PROJECT_PATH

# remove the pasted text (from '## Help' line)
sed -i "$((`grep -n '## Help' README.md  | cut -d: -f1`+3)),\$d" README.md
# and then, paste the up-to-date help
./$(basename $PROJECT_PATH) --help >> README.md
echo '```'                         >> README.md

git add README.md
git commit --amend # adding it to the bumpversion commit
